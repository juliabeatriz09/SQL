CREATE TABLE IF NOT EXISTS encaminhamento (
  id_encaminhamento INTEGER PRIMARY KEY AUTOINCREMENT,
  tipo_fo TEXT NOT NULL,
  justificativa TEXT NOT NULL,
  providencia TEXT,
  data DATE NOT NULL,
  cgm INTEGER,
  cpf_funcionario VARCHAR(14),
  id_fato INTEGER,
  FOREIGN KEY (cgm) REFERENCES aluno(cgm),
  FOREIGN KEY (cpf_funcionario) REFERENCES funcionario(cpf),
  FOREIGN KEY (id_fato) REFERENCES fato(id_fato)
);


create TABLE if NOT EXISTS responsavel(
 id_responsavel INTEGER PRIMARY KEY AUTOINCREMENT,
  nome VARCHAR (100)not NULL,
  grau_parentesco TEXT,
  telefone VARCHAR (11)NOT NULL UNIQUE,
  cpf VARCHAR (16)NOT NULL UNIQUE,
  email VARCHAR (50),
  cgm INTEGER,
  FOREIGN KEY (cgm) REFERENCES aluno(cgm)
);


CREATE TABLE if not EXISTS ata(
  id_ata integer primary KEY AUTOINCREMENT,
  aluno varchar (50) not null,
  dia date not null,
  assunto varchar (500) not null,
  monitor varchar(50) not null,
  conteudo varchar (300),
  encaminhamento varchar (200),
  cgm varchar (10) not null ,
  turma varchar (3) not null,
  prof varchar (20),
  fato varchar (20) not null
  );
  
   
  create TABLE if not EXISTS fato(
  id_fato integer primary key AUTOINCREMENT ,
  descricao varchar (200)not NULL,
  gravidade varchar(30) not NULL
  );
   
 
 
  CREATE table if not EXISTS frequencia (
  id_frequencia INTEGER PRIMARY KEY AUTOINCREMENT,
  dia date NOT NULL,
  quant_aulas int NOT NULL,
  ausencias int NOT NULL,
  turma varchar (4) NOT NULL,
  cpf_funcionario varchar,
  cgm INTEGER,
  FOREIGN KEY (cgm) REFERENCES aluno(cgm),
  FOREIGN KEY (cpf_funcionario) REFERENCES funcionario(cpf)
  );
  
  CREATE table if not EXISTS funcionario(
  nome VARCHAR(100) NOT NULL,
  cpf VARCHAR(14) NOT NULL UNIQUE PRIMARY key,
  nascimento date not null,
  rg varchar (16) not null,
  genero text,
  estado_civil text,
  email text,
  email_institucional text,
  telefone VARCHAR(15)NOT NULL UNIQUE,
  telefone_alternativo VARCHAR(15)NOT NULL,
  cep varchar (9),
  numero integer,
  complemento varchar (200),
  bairro varchar (100),
  cidade varchar (250),
  estado varchar (150),
  data_adimicao DATE NOT NULL,
  cargo varchar (500),
  carga_horaria integer,
  contrato varchar (80),
  numero_registro integer,
  id_funcao INTEGER,
  FOREIGN KEY (id_funcao) REFERENCES funcao(id)
  );
  
  CREATE TABLE IF NOT EXISTS funcao(
 funcionario VARCHAR (100)NOT NULL,
 descricao VARCHAR (150)NOT NULL,
 contrato VARCHAR (500)NOT NULL,
 id  INTEGER PRIMARY KEY AUTOINCREMENT
 );
 
  
CREATE TABLE IF NOT EXISTS ocorrencia (
  id_sequencial_ocorrencia INTEGER PRIMARY KEY AUTOINCREMENT,
  cpf_funcionario VARCHAR(14),
  data DATE NOT NULL,
  horario VARCHAR(5),
  cgm_aluno INTEGER,
  obs VARCHAR(500),
  turma VARCHAR(3) NOT NULL,
  id_fato INTEGER,
  FOREIGN KEY (id_fato) REFERENCES fato(id_fato),
  FOREIGN KEY (cpf_funcionario) REFERENCES funcionario(cpf),
  FOREIGN KEY (cgm_aluno) REFERENCES aluno(cgm)
);

CREATE TABLE IF NOT EXISTS aluno (
  cgm INTEGER PRIMARY KEY NOT NULL UNIQUE,
  nome VARCHAR(400) NOT NULL,
  nascimento DATE NOT NULL,
  cpf_aluno VARCHAR(14) NOT NULL UNIQUE,
  rg VARCHAR(16) NOT NULL UNIQUE,
  genero TEXT,
  email_aluno VARCHAR(800),
  telefone_aluno VARCHAR(15),
  endereco VARCHAR(500),
  cep VARCHAR(9),
  numero INTEGER,
  complemento VARCHAR(200),
  bairro VARCHAR(100),
  cidade VARCHAR(250),
  estado VARCHAR(150),
  curso VARCHAR(50) NOT NULL,
  turno VARCHAR(20) NOT NULL,
  turma VARCHAR(10) NOT NULL,
  responsavel VARCHAR(500),
  grau_parentesco VARCHAR(40),
  cpf_responsavel VARCHAR(14) NOT NULL,
  telefone_responsavel VARCHAR(15),
  email_responsavel VARCHAR(800)
);
  
SELECT 
  oco.id_sequencial_ocorrencia,
  f.descricao AS fato_descricao,
  a.nome AS nome_aluno,
  func.nome AS nome_funcionario,
  oco.data,
  oco.horario,
  oco.obs
FROM 
  ocorrencia oco
INNER JOIN fato f ON oco.id_fato = f.id_fato
INNER JOIN aluno a ON oco.cgm_aluno = a.cgm
INNER JOIN funcionario func ON oco.cpf_funcionario = func.cpf;

SELECT 
  f.ausencias AS freq_aluno,
  f.quant_aulas AS aulas,
  a.nome AS nome_aluno,
  a.turma AS turma_aluno
FROM 
  frequencia f
INNER JOIN aluno a ON f.cgm = a.cgm;

SELECT 
  e.id_encaminhamento,
  f.descricao AS fato_descricao,
  a.nome AS nome_aluno,
  func.nome AS nome_funcionario,
  e.data
FROM 
  encaminhamento e
INNER JOIN fato f ON e.id_fato = f.id_fato
INNER JOIN aluno a ON e.cgm = a.cgm
INNER JOIN funcionario func ON e.cpf_funcionario = func.cpf;



  
  
