create TABLE if NOT EXISTS encaminhamento(
  id_encaminhamento INTEGER PRIMARY KEY AUTOINCREMENT,
  tipo_fo TEXT not NULL ,
  justificativa TEXT not NULL,
  providencia TEXT,
  data DATE not NULL,
  cgm INTEGER,
  funcionario VARCHAR(14),
  FOREIGN KEY (cgm) REFERENCES aluno(cgm),
  FOREIGN KEY (funcionario) REFERENCES funcionario (cpf)
);

create TABLE if NOT EXISTS responsavel(
  id_responavel INTEGER PRIMARY KEY AUTOINCREMENT,
  nome VARCHAR (100)not NULL,
  grau_parentesco TEXT,
  telefone VARCHAR (11)NOT NULL UNIQUE,
  cpf VARCHAR (16)NOT NULL UNIQUE,
  email VARCHAR (50),
  cgm INTEGER,
  FOREIGN KEY (cgm) REFERENCES aluno(cgm)
);

CREATE TABLE if not EXISTS ata(
  id_ata integer primary KEY AUTOINCREMENT,
  aluno varchar (50) not null,
  dia date not null,
  assunto varchar (500) not null,
  monitor varchar(50) not null,
  conteudo varchar (300),
  encaminhamento varchar (200),
  cgm varchar (10) not null UNIQUE,
  turma varchar (3) not null,
  prof varchar (20),
  fato varchar (20) not null
  );
  
  create TABLE if not EXISTS fato(
  id_fato integer primary key AUTOINCREMENT ,
  descriçao varchar (200)not NULL,
  gravidade varchar(30) not NULL
  );
  
  CREATE table if not EXISTS frequencia (
  id_frequencia INTEGER PRIMARY KEY AUTOINCREMENT,
  dia date NOT NULL,
  quant_aulas int NOT NULL,
  ausencias int NOT NULL,
  turma varchar (4) NOT NULL,
  cgm INTEGER,
  FOREIGN KEY (cgm) REFERENCES aluno(cgm)
  );
  
  CREATE table if not EXISTS funcionario(
  nome VARCHAR(100) NOT NULL,
  cpf VARCHAR(14) NOT NULL UNIQUE PRIMARY key,
  nascimento date not null,
  rg varchar (16) not null,
  genero text,
  estado_civil text,
  email text,
  email_institucional text,
  telefone VARCHAR(15)NOT NULL UNIQUE,
  telefone_alternativo VARCHAR(15)NOT NULL,
  cep varchar (9),
  numero integer,
  complemento varchar (200),
  bairro varchar (100),
  cidade varchar (250),
  estado varchar (150),
  data_adimição DATE NOT NULL,
  cargo varchar (500),
  carga_horaria integer,
  contrato varchar (80),
  numero_registro integer,
  id  INTEGER,
  FOREIGN KEY (id) REFERENCES funcao(id)
  );
  
  CREATE TABLE IF NOT EXISTS funçao(
 funcionario VARCHAR (100)NOT NULL,
 descrição VARCHAR (150)NOT NULL,
 contrato VARCHAR (500)NOT NULL,
 id  INTEGER PRIMARY KEY AUTOINCREMENT
 );
 
 CREATE table if not EXISTS ocorrencia(
id_sequencial_ocorrencia INTEGER PRIMARY key AUTOINCREMENT,
fato_id varchar (50)NOT NULL, 
data DATE NOT NULL,
horario VARCHAR(4),
obs VARCHAR(500),
turma VARCHAR(3) NOT NULL 

);

CREATE table if not EXISTS aluno(
  cgm integer PRIMARY KEY  NOT null UNIQUE,
  nome varchar (400) not NULL,
  nascimento date not NULL, 
  cpf_aluno varchar (11) not NULL UNIQUE,
  rg varchar (9) NOT NULL unique,
  genero text,
  email_aluno varchar (800),
  telefone_aluno varchar (15),
  endereço varchar (500),
  cep varchar (9),
  numero integer,
  complemento varchar (200),
  bairro varchar (100),
  cidade varchar (250),
  estado varchar (150),
  curso varchar (50) not null ,
  turno varchar (20) NOT NULL,
  turma varchar (10) not NULL,
  responsavel varchar (500),
  grau_parentesco varchar (40),
  cpf_responsavel varchar (11) not NULL UNIQUE,
  telefone_responsavel varchar (15),
  email_responsavel varchar (800),
  id_fo integer,
  FOREIGN key (id_fo) REFERENCES fo (id_fo)
  );

INSERT INTO ocorrencia (id_fato, cpf_funcionario, data, horario, cgm_aluno, obs, turma)
VALUES (1, '789.484.987-45', '2025-04-24', '09:55', '1485484', 'Aluno demorou para entrar na sala', '3C');
SELECT 
  oco.id_sequencial_ocorrencia,
  f.descricao AS fato_descricao,
  a.nome AS nome_aluno,
  func.nome AS nome_funcionario,
  oco.data,
  oco.horario,
  oco.obs
FROM ocorrencia oco
JOIN fato f ON oco.id_fato = f.id_fato
JOIN aluno a ON oco.cgm_aluno = a.cgm
JOIN funcionario func ON oco.cpf_funcionario = func.cpf;

SELECT 
  f.ausencias AS faltas,
  f.quant_aulas AS aulas,
  a.nome AS nome_aluno,
  a.turma AS turma_aluno,
  func.nome AS professor
FROM frequencia f
JOIN aluno a ON f.cgm = a.cgm
JOIN funcionario func ON f.cpf_funcionario = func.cpf;

SELECT 
  e.id_encaminhamento,
  f.descricao AS fato,
  a.nome AS aluno,
  func.nome AS funcionario,
  e.data
FROM encaminhamento e
JOIN fato f ON e.id_fato = f.id_fato
JOIN aluno a ON e.cgm = a.cgm
JOIN funcionario func ON e.cpf_funcionario = func.cpf;
VALUES (1, '789.484.987-45', '2025-04-24', '09:55', '1485484', 'Aluno demorou para entrar na sala', '3C');
